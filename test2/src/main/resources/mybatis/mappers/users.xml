<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="users">

	<!-- INSERT (회원 가입) -->
	<insert id="insert" parameterType="UserVo">
		<selectKey keyProperty="userNo" resultType="long"
			order="BEFORE">
			SELECT user_no_seq.nextval FROM dual
		</selectKey>
		INSERT INTO users (user_no, username, birth, email, password, regdate)
		VALUES (#{userNo}, #{username}, #{birth}, #{email}, #{password},
		SYSDATE)
	</insert>
	
	<select id="selectAllUsers" resultType="UserVo">
		SELECT user_no AS userNo,
		username, birth, email, regdate, role
		FROM users
		ORDER BY user_no ASC
	</select>
	
	<select id="selectUsers" parameterType="long" resultType="UserVo">
		SELECT user_no AS userNo,
		username, birth, email, regdate, role
		FROM users
		WHERE user_no=#{userNo}
	</select>

	<select id="selectUserByEmail" parameterType="string"
		resultType="UserVo">
		SELECT user_no as userNo, username, birth, email, password,
		regdate
		FROM users
		WHERE email=#{value}
	</select>

	<!-- SELECT (이메일과 비밀번호로 사용자 정보 조회) -->
	<select id="selectUserByEmailAndPassword" parameterType="map"
		resultType="UserVo">
		SELECT user_no as userNo, username, birth, email, password,
		regdate, role
		FROM users
		WHERE email=#{email} AND password=#{password}
	</select>
	
	<!-- UPDATE (사용자 정보 수정) -->
	<update id="updateUser" parameterType="UserVo">
        UPDATE users
        SET username = #{username},
            email = #{email}
        WHERE user_no = #{userNo}
    </update> 

	<select id="getUpdate" parameterType="long" resultType="UserVo">
	    SELECT user_no AS userNo,
	           username,
	           birth,
	           email,
	           password,
	           regdate,
	           role
	      FROM users
	     WHERE user_no = #{updateNo, jdbcType=NUMERIC}
	</select>

	
	<!-- DELETE (사용자 정보 삭제) -->
	<delete id="deleteUser" parameterType="long">
		DELETE FROM users
		WHERE
		user_no=#{value}
	</delete>

</mapper>
